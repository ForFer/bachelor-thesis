{"ast":null,"code":"import _toConsumableArray from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/fernando/tfg/portal/reactfront/src/components/entry/entryTable.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport Dropzone from 'react-dropzone';\nimport 'rc-slider/assets/index.css';\nimport 'rc-tooltip/assets/bootstrap.css';\nimport Slider from 'rc-slider';\nimport { EntriesList, AuthorList, OrderBySelector, Button } from '../generics/searchGenerics';\nimport LightboxReview from './lightboxEdit';\nimport Lightbox from 'react-image-lightbox';\nimport 'react-image-lightbox/style.css';\nvar createSliderWithTooltip = Slider.createSliderWithTooltip;\nvar Range = createSliderWithTooltip(Slider.Range);\nvar currentYear = new Date().getYear() + 1900;\n\nfunction arrayUnique(array) {\n  var a = array.concat();\n\n  for (var i = 0; i < a.length; ++i) {\n    for (var j = i + 1; j < a.length; ++j) {\n      if (a[i].name === a[j].name) a.splice(j--, 1);\n    }\n  }\n\n  return a;\n}\n\nfunction yearBiggerThanCurrent(year) {\n  return parseInt(year) > currentYear;\n}\n\nvar DeleteModal = function DeleteModal(_ref) {\n  var title = _ref.title,\n      _onClick = _ref.onClick,\n      selectedId = _ref.selectedId,\n      onCancelClick = _ref.onCancelClick;\n  return React.createElement(\"div\", {\n    style: {\n      height: \"auto\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"dm_message\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44\n    },\n    __self: this\n  }, \"\\xBFEst\\xE1s seguro de querer borrar el registro \", title, \"?\"), React.createElement(\"div\", {\n    className: \"dm_btn_wrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary\",\n    id: \"dm_btn_delete\",\n    onClick: function onClick() {\n      return _onClick(selectedId);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  }, \"Borrar\"), React.createElement(\"button\", {\n    onClick: onCancelClick,\n    type: \"button\",\n    className: \"btn btn-secondary\",\n    \"data-dismiss\": \"modal\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53\n    },\n    __self: this\n  }, \"Cancelar\")));\n}; // Due to setState delay issues, variable managed on a higher level\n\n\nvar page = 0;\n\nvar EntryTable =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EntryTable, _Component);\n\n  function EntryTable(_props) {\n    var _this;\n\n    _classCallCheck(this, EntryTable);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EntryTable).call(this, _props));\n\n    _this.handle = function (props) {\n      _this.setState({\n        filter_from_year: props[0],\n        filter_to_year: props[1]\n      });\n    };\n\n    _this.handleInputChange = function (e) {\n      // When user types a new query, reset page number\n      page = 0;\n\n      _this.setState({\n        query_text: e.target.value\n      });\n    };\n\n    _this.onAuthorSelect = function (e) {\n      _this.setState({\n        filter_author: e.target.value\n      });\n    };\n\n    _this.onAuthorOrder = function (e) {\n      _this.setState({\n        order_by_author: e.target.value\n      });\n    };\n\n    _this.onTitleOrder = function (e) {\n      _this.setState({\n        order_by_title: e.target.value\n      });\n    };\n\n    _this.onYearOrder = function (e) {\n      _this.setState({\n        order_by_year: e.target.value\n      });\n    };\n\n    _this.onCreatedOrder = function (e) {\n      _this.setState({\n        order_by_created: e.target.value\n      });\n    };\n\n    _this.onChangeModalTitle = function (e) {\n      _this.setState({\n        modal_title: e.target.value\n      });\n    };\n\n    _this.onChangeModalAuthor = function (e) {\n      _this.setState({\n        modal_author: e.target.value\n      });\n    };\n\n    _this.onChangeModalYear = function (e) {\n      var errorMessage = e.target.value.match(/^[1-9]\\d{0,3}$|^0$/g) && !yearBiggerThanCurrent(e.target.value) ? \"\" : \"El año tiene que ser 0 o mayor, con un formato válido (01 no es válido), y menor que el año actual\";\n\n      _this.setState({\n        modal_year: e.target.value,\n        edit_error_message: errorMessage\n      });\n    };\n\n    _this.onEntryClick = function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      var entry = _this.state.data.entries.find(function (entry) {\n        return entry.id === parseInt(e.currentTarget.getAttribute(\"data-id\"));\n      });\n\n      _this.setState({\n        modal_title: entry.title,\n        modal_year: entry.year,\n        modal_author: entry.author,\n        modal_images: entry.entry_images,\n        modal_display: '',\n        display_detailed_view: ''\n      });\n    };\n\n    _this.editEntry = function (e, entry) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      _this.setState({\n        modal_display: '',\n        display_delete_modal: 'none',\n        display_edit_modal: '',\n        modal_title: entry.title,\n        modal_year: entry.year,\n        modal_author: entry.author,\n        selected_entry_id: entry.id\n      });\n    };\n\n    _this.editEntryImages = function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var imgs = _this.state.data.entries.filter(function (entry) {\n        return entry.id === _this.state.selected_entry_id;\n      })[0].entry_images;\n\n      _this.setState({\n        display_edit_imgs_modal: '',\n        modal_images: imgs\n      });\n    };\n\n    _this.addImgToEntry = function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      _this.setState({\n        display_add_modal: ''\n      });\n    };\n\n    _this.onFilesUpload = function (files) {\n      _this.setState({\n        modal_images: arrayUnique(_this.state.modal_images.concat(files))\n      });\n    };\n\n    _this.closeAddImgs = function () {\n      _this.setState({\n        display_add_modal: 'none',\n        modal_images: []\n      });\n    };\n\n    _this.state = {\n      data: {},\n      query_text: '',\n      filter_author: '',\n      filter_from_year: '',\n      filter_to_year: '',\n      order_by_year: '',\n      order_by_author: '',\n      order_by_title: '',\n      order_by_created: '',\n      isLoggedIn: true,\n      author: '',\n      min_year: '',\n      max_year: '',\n      page_size: 5,\n      base_url: _props.base_url,\n      total_elements: 0,\n      waiting_to_change: false,\n      modal_display: 'none',\n      modal_title: '',\n      modal_year: '',\n      modal_author: '',\n      modal_images: [],\n      edit_error_message: '',\n      display_edit_modal: 'none',\n      display_delete_modal: 'none',\n      display_edit_imgs_modal: 'none',\n      display_add_modal: 'none',\n      display_detailed_view: 'none',\n      display_img_detail: 'none',\n      isLightBoxOpen: false,\n      selected_entry_id: ''\n    };\n    _this.handle = _this.handle.bind();\n    _this.onAuthorSelect = _this.onAuthorSelect.bind(_assertThisInitialized(_this));\n    _this.onAuthorOrder = _this.onAuthorOrder.bind(_assertThisInitialized(_this));\n    _this.onTitleOrder = _this.onTitleOrder.bind(_assertThisInitialized(_this));\n    _this.onYearOrder = _this.onYearOrder.bind(_assertThisInitialized(_this));\n    _this.fetchData = _this.fetchData.bind(_assertThisInitialized(_this));\n    _this.onPreviousPage = _this.onPreviousPage.bind(_assertThisInitialized(_this));\n    _this.onNextPage = _this.onNextPage.bind(_assertThisInitialized(_this));\n    _this.onEntryClick = _this.onEntryClick.bind(_assertThisInitialized(_this));\n    _this.closeModal = _this.closeModal.bind(_assertThisInitialized(_this));\n    _this.handleInputChange = _this.handleInputChange.bind(_assertThisInitialized(_this));\n    _this.editEntry = _this.editEntry.bind(_assertThisInitialized(_this));\n    _this.removeEntry = _this.removeEntry.bind(_assertThisInitialized(_this));\n    _this.confirmRemoveEntry = _this.confirmRemoveEntry.bind(_assertThisInitialized(_this));\n    _this.getTitle = _this.getTitle.bind(_assertThisInitialized(_this));\n    _this.onChangeModalTitle = _this.onChangeModalTitle.bind(_assertThisInitialized(_this));\n    _this.onChangeModalAuthor = _this.onChangeModalAuthor.bind(_assertThisInitialized(_this));\n    _this.onChangeModalYear = _this.onChangeModalYear.bind(_assertThisInitialized(_this));\n    _this.saveEditEntry = _this.saveEditEntry.bind(_assertThisInitialized(_this));\n    _this.closeLightbox = _this.closeLightbox.bind(_assertThisInitialized(_this));\n    _this.closeAddImgs = _this.closeAddImgs.bind(_assertThisInitialized(_this));\n    _this.addImages = _this.addImages.bind(_assertThisInitialized(_this));\n    _this.showLightBox = _this.showLightBox.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(EntryTable, [{\n    key: \"fetchData\",\n    value: function fetchData() {\n      var _this2 = this;\n\n      this.setState({\n        total_elements: '',\n        waiting_to_change: true\n      });\n      axios.get(this.state.base_url + '/entries/', {\n        params: {\n          page_size: this.state.page_size,\n          page: page,\n          q: this.state.query_text,\n          order_year: this.state.order_by_year,\n          order_author: this.state.order_by_author,\n          order_title: this.state.order_by_title,\n          order_created: this.state.order_by_created,\n          from_year: this.state.filter_from_year,\n          to_year: this.state.filter_to_year,\n          author: this.state.filter_author\n        }\n      }).then(function (res) {\n        _this2.setState({\n          data: res.data,\n          total_elements: res.data.total,\n          waiting_to_change: false\n        });\n      });\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this3 = this;\n\n      axios.get(this.state.base_url + '/entry_meta').then(function (res) {\n        _this3.setState({\n          authors: res.data.authors,\n          min_year: parseInt(res.data.min_year),\n          max_year: parseInt(res.data.max_year),\n          filter_from_year: parseInt(res.data.min_year),\n          filter_to_year: parseInt(res.data.max_year)\n        });\n      });\n      this.fetchData();\n    }\n  }, {\n    key: \"onNextPage\",\n    value: function onNextPage() {\n      page += 1;\n      this.fetchData();\n    }\n  }, {\n    key: \"onPreviousPage\",\n    value: function onPreviousPage() {\n      page -= 1;\n      this.fetchData();\n    }\n  }, {\n    key: \"showLightBox\",\n    value: function showLightBox(index) {\n      this.setState({\n        isLightBoxOpen: true,\n        photoIndex: index,\n        display_img_detail: ''\n      });\n    }\n  }, {\n    key: \"closeModal\",\n    value: function closeModal() {\n      this.setState({\n        modal_display: 'none',\n        modal_title: '',\n        modal_year: '',\n        modal_author: '',\n        modal_images: [],\n        display_edit_modal: 'none',\n        display_delete_modal: 'none',\n        display_edit_imgs_modal: 'none',\n        display_add_modal: 'none',\n        display_detailed_view: 'none',\n        selected_entry_id: '',\n        edit_error_message: ''\n      });\n    }\n  }, {\n    key: \"closeLightbox\",\n    value: function closeLightbox() {\n      this.setState({\n        display_edit_imgs_modal: 'none',\n        modal_images: []\n      });\n    }\n  }, {\n    key: \"removeEntry\",\n    value: function removeEntry(e, id) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setState({\n        modal_display: '',\n        display_delete_modal: '',\n        display_edit_modal: 'none',\n        selected_entry_id: id\n      });\n    }\n  }, {\n    key: \"confirmRemoveEntry\",\n    value: function confirmRemoveEntry(id) {\n      var _this4 = this;\n\n      axios.delete(this.state.base_url + \"/entry/\".concat(id, \"/\"), {\n        headers: {\n          'Authorization': \"Token \".concat(localStorage.getItem(\"token\"))\n        }\n      }).then(function (res) {\n        _this4.closeModal();\n\n        _this4.fetchData();\n      });\n    }\n  }, {\n    key: \"getTitle\",\n    value: function getTitle() {\n      var _this5 = this;\n\n      var filtered_entry = this.state.data.entries.filter(function (entry) {\n        return entry.id === _this5.state.selected_entry_id;\n      });\n      return filtered_entry.length <= 0 ? \"\" : filtered_entry[0].title;\n    }\n  }, {\n    key: \"saveEditEntry\",\n    value: function saveEditEntry(e) {\n      var _this6 = this;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (!this.state.modal_title) {\n        this.setState({\n          edit_error_message: \"Introduce título por favor\"\n        });\n        return null;\n      }\n\n      if (!this.state.modal_author) {\n        this.setState({\n          edit_error_message: \"Introduce autor por favor\"\n        });\n        return null;\n      }\n\n      if (!this.state.modal_year) {\n        this.setState({\n          edit_error_message: \"Introduce año por favor\"\n        });\n        return null;\n      }\n\n      if (yearBiggerThanCurrent(this.state.modal_year)) {\n        this.setState({\n          edit_error_message: \"El año tiene que ser menor o igual al actual\"\n        });\n        return null;\n      }\n\n      var data = {\n        title: this.state.modal_title,\n        author: this.state.modal_author,\n        year: this.state.modal_year,\n        id: this.state.selected_entry_id\n      };\n      axios.patch(this.state.base_url + \"/entry/\".concat(this.state.selected_entry_id, \"/\"), data, {\n        headers: {\n          'Content-Type': 'application/json; charset=UTF-8',\n          'Authorization': \"Token \".concat(localStorage.getItem(\"token\"))\n        }\n      }).then(function (res) {\n        window.alert(\"Datos modificados correctamente\");\n\n        var indexOfEntry = _this6.state.data.entries.indexOf(_this6.state.data.entries.filter(function (entry) {\n          return entry.id === _this6.state.selected_entry_id;\n        })[0]);\n\n        var data = _this6.state.data;\n        data.entries[indexOfEntry].title = _this6.state.modal_title;\n        data.entries[indexOfEntry].author = _this6.state.modal_author;\n        data.entries[indexOfEntry].year = _this6.state.modal_year;\n\n        _this6.setState({\n          data: data\n        });\n      }).catch(function (error) {\n        _this6.setState({\n          edit_error_message: error.response.message\n        });\n      });\n    }\n  }, {\n    key: \"onImgRemove\",\n    value: function onImgRemove(e, name) {\n      e.preventDefault();\n      e.stopPropagation();\n      var imgs = this.state.modal_images;\n      this.setState({\n        modal_images: imgs.filter(function (img) {\n          return img.name !== name;\n        })\n      });\n    }\n  }, {\n    key: \"addImages\",\n    value: function addImages(e) {\n      var _this7 = this;\n\n      var formData = new FormData();\n      formData.append(\"entry_id\", this.state.selected_entry_id);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.state.modal_images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var image = _step.value;\n          formData.append('images', image);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      axios.post(this.state.base_url + '/images/', formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          'Authorization': \"Token \".concat(localStorage.getItem(\"token\"))\n        }\n      }).then( // On post new image(s), will receive the details of the image(s)\n      // Push that image to the state data in order to have an updated version\n      // without need of refreshing \n      function (res) {\n        var _data$entries$selecte;\n\n        var newImgs = res.data;\n        var data = _this7.state.data;\n        var selected_index = data.entries.findIndex(function (entry) {\n          return entry.id === _this7.state.selected_entry_id;\n        });\n\n        (_data$entries$selecte = data.entries[selected_index].entry_images).push.apply(_data$entries$selecte, _toConsumableArray(newImgs));\n\n        window.alert(\"Cambios guardados correctamente\");\n\n        _this7.setState({\n          edit_error_message: '',\n          modal_images: [],\n          data: data\n        });\n\n        _this7.closeAddImgs();\n      }).catch(function (error) {\n        _this7.setState({\n          edit_error_message: error.response.data[0]\n        });\n      });\n    } // This should be modified slightly to allow the table to be\n    // rendered individually\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this8 = this;\n\n      console.log(this.state.modal_images);\n\n      if (this.state.min_year === '' || this.state.max_year === '' || this.state.total_elements === '') {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 527\n          },\n          __self: this\n        });\n      }\n\n      if (this.state.waiting_to_change) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 531\n          },\n          __self: this\n        });\n      }\n\n      var img_leng = this.state.modal_images.length;\n      var photoIndex = this.state.photoIndex;\n      return React.createElement(\"div\", {\n        className: \"search_container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 539\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"modal_entry\",\n        style: {\n          display: this.state.modal_display\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 541\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          display: this.state.display_add_modal\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 542\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"modal_add_imgs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 543\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"edit_entry_add_imgs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 544\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        style: {\n          textAlign: \"center\",\n          padding: \"10px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 545\n        },\n        __self: this\n      }, \"A\\xF1adir imagenes al registro\"), React.createElement(Dropzone, {\n        onDrop: function onDrop(acceptedFiles) {\n          return _this8.onFilesUpload(acceptedFiles);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546\n        },\n        __self: this\n      }, function (_ref2) {\n        var getRootProps = _ref2.getRootProps,\n            getInputProps = _ref2.getInputProps,\n            isDragActive = _ref2.isDragActive;\n        return React.createElement(\"section\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 549\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: {\n            fontSize: \"small\",\n            fontStyle: \"italic\",\n            textAlign: \"center\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 550\n          },\n          __self: this\n        }, \"Los nombres de las imagenes tienen que ser \\xFAnicos\"), React.createElement(\"div\", Object.assign({}, getRootProps(), {\n          className: \"dropzone addDropzone\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 553\n          },\n          __self: this\n        }), React.createElement(\"input\", Object.assign({}, getInputProps(), {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 555\n          },\n          __self: this\n        })), _this8.state.modal_images.length === 0 ? isDragActive ? React.createElement(\"div\", {\n          className: \"drop_label row\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 559\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          style: {\n            width: \"100%\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 560\n          },\n          __self: this\n        }, \"Suelta las im\\xE1genes aqui... \")) : React.createElement(\"div\", {\n          className: \"drop_label row\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 562\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          style: {\n            width: \"100%\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 563\n          },\n          __self: this\n        }, \" Arrastra y suelta las im\\xE1genes, o had click aqu\\xED para seleccionar imagenes\")) : null, _this8.state.display_add_modal === '' ? _this8.state.modal_images.map(function (image) {\n          return React.createElement(\"div\", {\n            className: \"addentry_row row\",\n            key: image.name,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 572\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"col-10\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 574\n            },\n            __self: this\n          }, image.name), React.createElement(\"div\", {\n            className: \"col-2\",\n            style: {\n              cursor: \"pointer\"\n            },\n            onClick: function onClick(e) {\n              return _this8.onImgRemove(e, image.name);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 575\n            },\n            __self: this\n          }, \" Borrar \"));\n        }) : null));\n      }), React.createElement(\"div\", {\n        className: \"modal_add_btns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 585\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: \"btn btn-primary\",\n        onClick: this.addImages,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 587\n        },\n        __self: this\n      }, \"A\\xF1adir imagenes\"), React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closeAddImgs,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 593\n        },\n        __self: this\n      }, \"Cancelar\"), React.createElement(\"div\", {\n        className: \"login_error\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 599\n        },\n        __self: this\n      }, \" \", this.state.edit_error_message, \" \"))))), React.createElement(\"div\", {\n        className: \"modal_edit_entry_detail\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 604\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close\",\n        id: \"btn_close_modal\",\n        \"aria-label\": \"Close\",\n        onClick: this.closeModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 605\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        \"aria-hidden\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 606\n        },\n        __self: this\n      }, \"\\xD7\")), React.createElement(\"div\", {\n        style: {\n          display: this.state.display_delete_modal\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 608\n        },\n        __self: this\n      }, React.createElement(DeleteModal, {\n        title: this.getTitle(),\n        onClick: this.confirmRemoveEntry,\n        selectedId: this.state.selected_entry_id,\n        onCancelClick: this.closeModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 609\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        style: {\n          display: this.state.display_edit_modal\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 616\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"form_edit_entry height_100\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 617\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 618\n        },\n        __self: this\n      }, \"Editar registro\"), React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 619\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"username_label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 620\n        },\n        __self: this\n      }, \"T\\xEDtulo\"), React.createElement(\"input\", {\n        value: this.state.modal_title,\n        onChange: this.onChangeModalTitle,\n        type: \"text\",\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 621\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 626\n        },\n        __self: this\n      }), React.createElement(\"label\", {\n        className: \"useremail_label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 627\n        },\n        __self: this\n      }, \"Autor\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 628\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        value: this.state.modal_author,\n        onChange: this.onChangeModalAuthor,\n        type: \"text\",\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 629\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 634\n        },\n        __self: this\n      }), React.createElement(\"label\", {\n        className: \"userpass_label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 636\n        },\n        __self: this\n      }, \"A\\xF1o\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 637\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        value: this.state.modal_year,\n        onChange: this.onChangeModalYear,\n        type: \"text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 638\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 643\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        style: {\n          margin: \"5px 0px\"\n        },\n        onClick: function onClick(e) {\n          return _this8.saveEditEntry(e);\n        },\n        type: \"button\",\n        className: \"btn btn-primary\",\n        \"data-dismiss\": \"modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 645\n        },\n        __self: this\n      }, \"Guardar\"), React.createElement(\"div\", {\n        style: {\n          color: \"red\",\n          textAlign: \"center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 654\n        },\n        __self: this\n      }, this.state.edit_error_message)), React.createElement(\"div\", {\n        className: \"edit_entry_img_btns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 658\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        style: {\n          marginRight: \"10px\"\n        },\n        onClick: this.addImgToEntry,\n        type: \"button\",\n        className: \"btn btn-primary\",\n        \"data-dismiss\": \"modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 659\n        },\n        __self: this\n      }, \"A\\xF1adir imagenes\"), React.createElement(\"button\", {\n        onClick: function onClick(e) {\n          return _this8.editEntryImages(e);\n        },\n        type: \"button\",\n        className: \"btn btn-primary\",\n        \"data-dismiss\": \"modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 668\n        },\n        __self: this\n      }, \"Editar imagenes\")), React.createElement(\"button\", {\n        onClick: this.closeModal,\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        \"data-dismiss\": \"modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 677\n        },\n        __self: this\n      }, \"Cerrar\"))), React.createElement(\"div\", {\n        style: {\n          display: this.state.display_edit_imgs_modal\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 686\n        },\n        __self: this\n      }, React.createElement(LightboxReview, {\n        closeModal: this.closeLightbox,\n        entry_id: this.state.selected_entry_id,\n        imgs: this.state.modal_images,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 687\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"entry_flex_wrapper modal_entry_detail\",\n        style: {\n          display: this.state.display_detailed_view\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 694\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close\",\n        id: \"btn_close_modal\",\n        \"aria-label\": \"Close\",\n        onClick: this.closeModal,\n        style: {\n          position: \"absolute\",\n          right: \"0\",\n          top: \"0\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 697\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        \"aria-hidden\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 704\n        },\n        __self: this\n      }, \"\\xD7\")), React.createElement(\"div\", {\n        className: \"m_data row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 706\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 706\n        },\n        __self: this\n      }, \"Vista de registro detallada\")), React.createElement(\"div\", {\n        className: \"m_data row m_title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 707\n        },\n        __self: this\n      }, \"T\\xEDtulo: \", this.state.modal_title), React.createElement(\"div\", {\n        className: \"m_data row m_author\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 708\n        },\n        __self: this\n      }, \"Autor: \", this.state.modal_author), React.createElement(\"div\", {\n        className: \"m_data row m_year\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 709\n        },\n        __self: this\n      }, \"A\\xF1o: \", this.state.modal_year), React.createElement(\"div\", {\n        className: \"m_data row m_imagenes_title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 710\n        },\n        __self: this\n      }, \"Imagenes\"), React.createElement(\"div\", {\n        className: \"m_data row m_images\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 711\n        },\n        __self: this\n      }, React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 712\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"m_imagenes_imgs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 714\n        },\n        __self: this\n      }, this.state.modal_images.map(function (img) {\n        return React.createElement(\"div\", {\n          key: img.id,\n          className: \"modalImageDetail\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 717\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          alt: \"\",\n          className: _this8.state.data.image_ids && _this8.state.data.image_ids.includes(img.id) ? \"eid_image result_found\" : \"eid_image \",\n          id: img.id,\n          src: _this8.state.base_url + img.image,\n          onClick: function onClick() {\n            return _this8.showLightBox(_this8.state.modal_images.indexOf(img));\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 718\n          },\n          __self: this\n        }));\n      })))), React.createElement(\"div\", {\n        className: \"modal_img_detail\",\n        style: {\n          display: this.state.img_detail_display\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 734\n        },\n        __self: this\n      }, this.state.isLightBoxOpen && React.createElement(Lightbox, {\n        mainSrc: this.state.base_url + this.state.modal_images[photoIndex].image,\n        nextSrc: this.state.base_url + this.state.modal_images[img_leng > 1 ? (photoIndex + 1) % img_leng : 0].image,\n        prevSrc: this.state.base_url + this.state.modal_images[img_leng > 1 ? (photoIndex + img_leng - 1) % img_leng : 0].image,\n        onCloseRequest: function onCloseRequest() {\n          return _this8.setState({\n            isLightBoxOpen: false\n          });\n        },\n        onMovePrevRequest: function onMovePrevRequest() {\n          return _this8.setState({\n            photoIndex: (photoIndex + img_leng - 1) % img_leng\n          });\n        },\n        onMoveNextRequest: function onMoveNextRequest() {\n          return _this8.setState({\n            photoIndex: (photoIndex + 1) % img_leng\n          });\n        },\n        clickOutsideToClose: true,\n        wrapperClassName: this.state.data.image_ids && this.state.data.image_ids.includes(this.state.modal_images[photoIndex].id) ? \"result_found_lightbox\" : null,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 739\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 768\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"search_filters col-xs-4 col-md-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 769\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_category xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 770\n        },\n        __self: this\n      }, \"Filtros\"), React.createElement(\"div\", {\n        className: \"search_filter sf_border_bottom xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 774\n        },\n        __self: this\n      }, \"Autor\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 777\n        },\n        __self: this\n      }, React.createElement(AuthorList, {\n        onChange: this.onAuthorSelect,\n        authors: this.state.authors,\n        value: this.state.filter_author,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 778\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_filter xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 785\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 786\n        },\n        __self: this\n      }, \"Filtro por a\\xF1o\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 789\n        },\n        __self: this\n      }, React.createElement(Range, {\n        min: this.state.min_year,\n        max: this.state.max_year,\n        defaultValue: [this.state.filter_from_year, this.state.filter_to_year],\n        onChange: this.handle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"sf_value\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 797\n        },\n        __self: this\n      }, this.state.filter_from_year, \" - \", this.state.filter_to_year)), React.createElement(\"div\", {\n        className: \"sf_category xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 801\n        },\n        __self: this\n      }, \"Ordenar por...\"), React.createElement(\"div\", {\n        className: \"search_filter sf_border_bottom xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 804\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 805\n        },\n        __self: this\n      }, \"Autor\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 808\n        },\n        __self: this\n      }, React.createElement(OrderBySelector, {\n        onChange: this.onAuthorOrder,\n        name: \"order_by_author\",\n        value: this.state.order_by_author,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 809\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_filter sf_border_bottom xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 817\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 818\n        },\n        __self: this\n      }, \"Fecha creaci\\xF3n registro\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 821\n        },\n        __self: this\n      }, React.createElement(OrderBySelector, {\n        onChange: this.onCreatedOrder,\n        name: \"order_by_reated\",\n        value: this.state.order_by_created,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 822\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_filter sf_border_bottom xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 830\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 831\n        },\n        __self: this\n      }, \"T\\xEDtulo\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 834\n        },\n        __self: this\n      }, React.createElement(OrderBySelector, {\n        onChange: this.onTitleOrder,\n        name: \"order_by_title\",\n        value: this.state.order_by_title,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 835\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_filter xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 842\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sf_name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 843\n        },\n        __self: this\n      }, \"A\\xF1o\"), React.createElement(\"div\", {\n        className: \"sf_filter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 846\n        },\n        __self: this\n      }, React.createElement(OrderBySelector, {\n        onChange: this.onYearOrder,\n        name: \"order_by_year\",\n        value: this.state.order_by_year,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 847\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"search_filter xs-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 854\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.fetchData,\n        className: \"sf_name filter_btn\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 855\n        },\n        __self: this\n      }, \"Refinar la busqueda!\"))), React.createElement(\"div\", {\n        className: \"search_results_wrapper col-xs-8 col-md-10\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 860\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"search_results\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 861\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"sr_searchbar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 862\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        onChange: this.handleInputChange,\n        type: \"text\",\n        id: \"searchBarSearch\",\n        className: \"form-control col-xs-9 display_inline_block\",\n        value: this.state.query_text,\n        required: \"\",\n        autoFocus: true,\n        onKeyPress: function onKeyPress(e) {\n          if (e.key === 'Enter') {\n            _this8.fetchData();\n          }\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 863\n        },\n        __self: this\n      }), React.createElement(\"span\", {\n        className: \"input-group-btn col-xs-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 878\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.fetchData,\n        className: \"btn btn-search\",\n        type: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 879\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fa fa-search fa-fw display_inline_block\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 880\n        },\n        __self: this\n      })))), React.createElement(EntriesList, {\n        entries: this.state.data.entries,\n        resultOnImgs: this.state.data.image_ids,\n        base_url: this.state.base_url,\n        onClick: this.onEntryClick,\n        onRemoveClick: this.removeEntry,\n        onEditClick: this.editEntry,\n        editDelete: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 884\n        },\n        __self: this\n      }), this.state.total_elements > 0 ? React.createElement(\"div\", {\n        className: \"pagination_container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 893\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"total_elements\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 894\n        },\n        __self: this\n      }, page * this.state.page_size + 1, \" - \", Math.min(this.state.total_elements, (1 + page) * this.state.page_size), \" de \", this.state.total_elements), React.createElement(Button, {\n        name: \"previous_page_btn\",\n        disabled: page + 1 === 1,\n        onClick: this.onPreviousPage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 897\n        },\n        __self: this\n      }), React.createElement(Button, {\n        name: \"next_page_btn\",\n        disabled: page + 1 === Math.ceil(this.state.total_elements / this.state.page_size),\n        onClick: this.onNextPage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 900\n        },\n        __self: this\n      })) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 905\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return EntryTable;\n}(Component);\n\nexport default EntryTable;","map":{"version":3,"sources":["/home/fernando/tfg/portal/reactfront/src/components/entry/entryTable.js"],"names":["React","Component","axios","Dropzone","Slider","EntriesList","AuthorList","OrderBySelector","Button","LightboxReview","Lightbox","createSliderWithTooltip","Range","currentYear","Date","getYear","arrayUnique","array","a","concat","i","length","j","name","splice","yearBiggerThanCurrent","year","parseInt","DeleteModal","title","onClick","selectedId","onCancelClick","height","page","EntryTable","props","handle","setState","filter_from_year","filter_to_year","handleInputChange","e","query_text","target","value","onAuthorSelect","filter_author","onAuthorOrder","order_by_author","onTitleOrder","order_by_title","onYearOrder","order_by_year","onCreatedOrder","order_by_created","onChangeModalTitle","modal_title","onChangeModalAuthor","modal_author","onChangeModalYear","errorMessage","match","modal_year","edit_error_message","onEntryClick","stopPropagation","preventDefault","entry","state","data","entries","find","id","currentTarget","getAttribute","author","modal_images","entry_images","modal_display","display_detailed_view","editEntry","display_delete_modal","display_edit_modal","selected_entry_id","editEntryImages","imgs","filter","display_edit_imgs_modal","addImgToEntry","display_add_modal","onFilesUpload","files","closeAddImgs","isLoggedIn","min_year","max_year","page_size","base_url","total_elements","waiting_to_change","display_img_detail","isLightBoxOpen","bind","fetchData","onPreviousPage","onNextPage","closeModal","removeEntry","confirmRemoveEntry","getTitle","saveEditEntry","closeLightbox","addImages","showLightBox","get","params","q","order_year","order_author","order_title","order_created","from_year","to_year","then","res","total","authors","index","photoIndex","delete","headers","localStorage","getItem","filtered_entry","patch","window","alert","indexOfEntry","indexOf","catch","error","response","message","img","formData","FormData","append","image","post","newImgs","selected_index","findIndex","push","console","log","img_leng","display","textAlign","padding","acceptedFiles","getRootProps","getInputProps","isDragActive","fontSize","fontStyle","width","map","cursor","onImgRemove","margin","color","marginRight","position","right","top","image_ids","includes","img_detail_display","key","Math","min","ceil"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nimport axios from 'axios';\n\nimport Dropzone from 'react-dropzone'\n\nimport 'rc-slider/assets/index.css';\nimport 'rc-tooltip/assets/bootstrap.css';\n\nimport Slider from 'rc-slider';\n\nimport { EntriesList, AuthorList, OrderBySelector, Button } from '../generics/searchGenerics'\nimport LightboxReview from './lightboxEdit';\n\nimport Lightbox from 'react-image-lightbox';\nimport 'react-image-lightbox/style.css';\n\n\nconst createSliderWithTooltip = Slider.createSliderWithTooltip;\nconst Range = createSliderWithTooltip(Slider.Range);\n\nconst currentYear = new Date().getYear() + 1900;\n\nfunction arrayUnique(array) {\n    var a = array.concat();\n    for(var i=0; i<a.length; ++i) {\n        for(var j=i+1; j<a.length; ++j) {\n            if(a[i].name === a[j].name)\n                a.splice(j--, 1);\n        }\n    }\n\n    return a;\n}\n\nfunction yearBiggerThanCurrent(year) {\n    return parseInt(year) > currentYear;\n}\n\nconst DeleteModal = ({title, onClick, selectedId, onCancelClick}) => (\n    <div \n        style={{height: \"auto\"}}\n        >\n        <div className=\"dm_message\">¿Estás seguro de querer borrar el registro {title}?</div>\n        <div className=\"dm_btn_wrapper\">\n            <button type=\"button\" \n                    className=\"btn btn-primary\" \n                    id=\"dm_btn_delete\"\n                    onClick={() => onClick(selectedId)}>\n                    Borrar \n                    </button>\n\n            <button onClick={onCancelClick} \n                    type=\"button\" \n                    className=\"btn btn-secondary\" \n                    data-dismiss=\"modal\">\n                    Cancelar\n                    </button>\n        </div>\n    </div>\n);\n\n// Due to setState delay issues, variable managed on a higher level\nlet page = 0;\n\nclass EntryTable extends Component {\n    \n    constructor(props){\n        super(props)\n\n        this.state = {\n            data: {},\n            query_text: '',\n            \n            filter_author: '',\n            filter_from_year: '',\n            filter_to_year: '',\n            \n            order_by_year: '',\n            order_by_author: '',\n            order_by_title: '',\n            order_by_created: '',\n\n            isLoggedIn: true,\n\n            author:   '',\n            min_year: '',\n            max_year: '',\n\n            page_size: 5,\n\n            base_url: props.base_url,\n            total_elements: 0,\n\n            waiting_to_change: false,\n\n            modal_display: 'none',\n            modal_title: '',\n            modal_year: '',\n            modal_author: '',\n            modal_images: [],\n            edit_error_message:'',\n\n            display_edit_modal: 'none',\n            display_delete_modal: 'none',\n            display_edit_imgs_modal:'none',\n            display_add_modal:'none',\n            display_detailed_view: 'none',\n            display_img_detail: 'none',\n            isLightBoxOpen: false,\n            selected_entry_id: '',\n        }\n        \n        this.handle = this.handle.bind()\n        this.onAuthorSelect = this.onAuthorSelect.bind(this)\n        this.onAuthorOrder = this.onAuthorOrder.bind(this)\n        this.onTitleOrder = this.onTitleOrder.bind(this)\n        this.onYearOrder = this.onYearOrder.bind(this)\n\n        this.fetchData = this.fetchData.bind(this)\n        this.onPreviousPage = this.onPreviousPage.bind(this)\n        this.onNextPage = this.onNextPage.bind(this)\n        this.onEntryClick = this.onEntryClick.bind(this)\n        this.closeModal = this.closeModal.bind(this)\n        this.handleInputChange = this.handleInputChange.bind(this)\n\n        this.editEntry = this.editEntry.bind(this);\n        this.removeEntry = this.removeEntry.bind(this)\n        this.confirmRemoveEntry = this.confirmRemoveEntry.bind(this)\n        this.getTitle = this.getTitle.bind(this)\n\n        this.onChangeModalTitle = this.onChangeModalTitle.bind(this);\n        this.onChangeModalAuthor = this.onChangeModalAuthor.bind(this);\n        this.onChangeModalYear = this.onChangeModalYear.bind(this);\n        this.saveEditEntry = this.saveEditEntry.bind(this);\n\n        this.closeLightbox = this.closeLightbox.bind(this);\n        this.closeAddImgs = this.closeAddImgs.bind(this);\n\n        this.addImages = this.addImages.bind(this);\n        this.showLightBox = this.showLightBox.bind(this);\n    }\n  \n    fetchData(){\n        this.setState({total_elements:'', waiting_to_change:true})\n\n        axios.get(this.state.base_url + '/entries/', \n        {\n            params: {\n                page_size: this.state.page_size,\n                page: page,\n                q: this.state.query_text,\n                order_year: this.state.order_by_year,\n                order_author: this.state.order_by_author,\n                order_title: this.state.order_by_title,\n                order_created: this.state.order_by_created,\n                from_year: this.state.filter_from_year,\n                to_year: this.state.filter_to_year,\n                author: this.state.filter_author\n            }\n        })\n        .then(\n            res => {\n                this.setState({\n                    data: res.data,\n                    total_elements: res.data.total,\n                    waiting_to_change: false,\n                })\n            }\n        )\n    }\n\n    componentWillMount(){\n        axios.get(this.state.base_url + '/entry_meta').then(\n            res => {\n                this.setState({\n                    authors:  res.data.authors,\n                    min_year: parseInt(res.data.min_year),\n                    max_year: parseInt(res.data.max_year),\n                    filter_from_year: parseInt(res.data.min_year),\n                    filter_to_year: parseInt(res.data.max_year),\n                })\n            }\n        )\n\n        this.fetchData();\n    }\n\n    handle = (props) => {\n        this.setState({\n            filter_from_year: props[0],\n            filter_to_year: props[1],\n        })            \n    };\n\n    handleInputChange = (e) => {\n        // When user types a new query, reset page number\n        page = 0;\n        this.setState({query_text: e.target.value});\n    }\n\n    onAuthorSelect = (e) => {\n        this.setState({filter_author: e.target.value});\n    } \n\n    onAuthorOrder = (e) => {\n        this.setState({order_by_author: e.target.value})\n    }\n\n    onTitleOrder = (e) => {\n        this.setState({order_by_title: e.target.value})\n    }\n\n    onYearOrder = (e) => {\n        this.setState({order_by_year: e.target.value})\n    }\n\n    onCreatedOrder = (e) => {\n        this.setState({order_by_created: e.target.value})\n    }\n\n    onChangeModalTitle = (e) => {\n        this.setState({modal_title: e.target.value})\n    }\n\n    onChangeModalAuthor = (e) => {\n        this.setState({modal_author: e.target.value})\n    }\n    \n    onChangeModalYear = (e) => {\n        let errorMessage = (e.target.value.match(/^[1-9]\\d{0,3}$|^0$/g) \n                            && !yearBiggerThanCurrent(e.target.value) ) \n                            ? \"\"\n                            : \"El año tiene que ser 0 o mayor, con un formato válido (01 no es válido), y menor que el año actual\"\n    \n        this.setState({\n            modal_year: e.target.value,\n            edit_error_message: errorMessage,\n        })\n    }\n\n    onNextPage(){\n        page += 1;\n        this.fetchData()\n    }\n\n    onPreviousPage(){\n        page -= 1;\n        this.fetchData()\n    }\n\n    onEntryClick = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        let entry = this.state.data.entries.find(\n                    entry => entry.id === parseInt(e.currentTarget.getAttribute(\"data-id\")));\n\n        this.setState({\n            modal_title: entry.title,\n            modal_year: entry.year,\n            modal_author: entry.author,\n            modal_images: entry.entry_images,\n            modal_display: '',\n            display_detailed_view: '',\n        })\n    }\n\n    editEntry = (e, entry) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.setState({\n            modal_display: '',\n            display_delete_modal: 'none',\n            display_edit_modal: '',\n            modal_title: entry.title,\n            modal_year: entry.year,\n            modal_author: entry.author,\n            selected_entry_id: entry.id,\n        })\n    }\n\n    showLightBox(index){    \n        this.setState({\n            isLightBoxOpen: true,\n            photoIndex: index, \n            display_img_detail: '',\n        })\n\n    }\n\n    closeModal() {\n        this.setState({\n            modal_display: 'none',\n            modal_title: '',\n            modal_year: '',\n            modal_author: '',\n            modal_images: [],\n            display_edit_modal: 'none',\n            display_delete_modal: 'none',\n            display_edit_imgs_modal:'none',\n            display_add_modal:'none',\n            display_detailed_view: 'none',\n            selected_entry_id: '',\n            edit_error_message:'',\n        })\n    }\n\n    closeLightbox() {\n        this.setState({\n            display_edit_imgs_modal: 'none',\n            modal_images: [],\n        })\n    }\n\n    removeEntry(e, id) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.setState({\n            modal_display: '',\n            display_delete_modal: '',\n            display_edit_modal: 'none',\n            selected_entry_id: id,\n        })\n    }\n\n    confirmRemoveEntry(id) {\n        axios.delete(this.state.base_url + `/entry/${id}/`,\n            { \n                headers: {\n                    'Authorization': `Token ${localStorage.getItem(\"token\")}`,\n                }\n            })\n            .then(\n                res => {\n                    this.closeModal();\n                    this.fetchData();\n                }\n            )\n    }\n\n    getTitle() {\n        let filtered_entry = this.state.data.entries.filter(entry => entry.id===this.state.selected_entry_id );\n        return ( filtered_entry.length <= 0 )\n            ? \"\"\n            : filtered_entry[0].title        \n    }\n\n    saveEditEntry(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!this.state.modal_title){\n            this.setState({\n                edit_error_message: \"Introduce título por favor\"\n            })\n            return null;\n        }\n        \n        if (!this.state.modal_author){\n            this.setState({\n                edit_error_message: \"Introduce autor por favor\"\n            })\n            return null;\n        }\n\n        if (!this.state.modal_year){\n            this.setState({\n                edit_error_message: \"Introduce año por favor\"\n            })\n            return null;\n        }\n\n        if (yearBiggerThanCurrent(this.state.modal_year) ){\n            this.setState({\n                edit_error_message: \"El año tiene que ser menor o igual al actual\"\n            })\n            return null;\n        }\n\n        var data={\n            title: this.state.modal_title,\n            author: this.state.modal_author,\n            year: this.state.modal_year,\n            id: this.state.selected_entry_id\n        }\n\n        axios.patch(this.state.base_url + `/entry/${this.state.selected_entry_id}/`,\n            data,\n            {\n                headers: {\n                    'Content-Type': 'application/json; charset=UTF-8',\n                    'Authorization': `Token ${localStorage.getItem(\"token\")}`,\n                }\n            }\n        ).then(\n            res => {\n\n                window.alert(\"Datos modificados correctamente\");\n                var indexOfEntry = this.state.data.entries.indexOf(\n                                        this.state.data.entries.filter(\n                                            entry => \n                                            entry.id === this.state.selected_entry_id)[0]\n                                    )\n\n\n                var data = this.state.data;\n                data.entries[indexOfEntry].title = this.state.modal_title;\n                data.entries[indexOfEntry].author = this.state.modal_author;\n                data.entries[indexOfEntry].year = this.state.modal_year;\n\n                this.setState({\n                    data: data,    \n                })\n            }\n        ).catch(\n            error => {\n                this.setState({\n                    edit_error_message: error.response.message\n                })\n            }\n        )\n    }\n\n    editEntryImages = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var imgs = this.state.data.entries.filter(\n            entry => entry.id === this.state.selected_entry_id \n        )[0].entry_images\n\n        this.setState({\n            display_edit_imgs_modal: '',\n            modal_images: imgs,\n        })\n    }\n\n    addImgToEntry = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.setState({\n            display_add_modal: '',\n        })\n    }\n\n    onFilesUpload = (files) => {\n        this.setState({\n            modal_images: arrayUnique(this.state.modal_images.concat(files))\n        })\n    }\n\n    closeAddImgs = () => {\n        this.setState({\n            display_add_modal: 'none',\n            modal_images: [],    \n        })\n    }\n\n    onImgRemove(e, name) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var imgs = this.state.modal_images;\n        this.setState({\n            modal_images: imgs.filter(img => img.name !== name),\n        })\n    }\n\n    addImages(e) {\n\n        const formData = new FormData();\n        formData.append(\"entry_id\", this.state.selected_entry_id)        \n\n        for (const image of this.state.modal_images) {\n            formData.append('images', image)\n        }\n\n        axios.post(this.state.base_url + '/images/',\n            formData,\n            {\n                headers: {\n                    \"Content-Type\":\"multipart/form-data\",\n                    'Authorization': `Token ${localStorage.getItem(\"token\")}`,\n                }\n            }\n        )\n        .then(\n            // On post new image(s), will receive the details of the image(s)\n            // Push that image to the state data in order to have an updated version\n            // without need of refreshing \n            res => {\n                var newImgs = res.data;\n                var data = this.state.data;\n                \n                var selected_index = data.entries.findIndex(entry => entry.id === this.state.selected_entry_id);\n                data.entries[selected_index].entry_images.push(...newImgs)\n\n                window.alert(\"Cambios guardados correctamente\");\n                this.setState({\n                    edit_error_message: '',\n                    modal_images: [],\n                    data: data,\n                })\n                this.closeAddImgs();\n            }\n        ).catch(\n            error => {\n                this.setState({\n                    edit_error_message: error.response.data[0],\n                })\n            }\n        )\n    }\n\n\n    // This should be modified slightly to allow the table to be\n    // rendered individually\n    render() {\n\n        console.log(this.state.modal_images);\n\n        if ( this.state.min_year === '' || this.state.max_year === '' || this.state.total_elements === '' ) {\n            return <div />\n        }\n\n        if( this.state.waiting_to_change ) {\n            return <div />\n        }\n\n        const img_leng = this.state.modal_images.length;\n        const photoIndex = this.state.photoIndex;\n\n        return (\n\n        <div className=\"search_container\">\n\n            <div className=\"modal_entry\"  style={{display: this.state.modal_display}} >\n                <div style={{display: this.state.display_add_modal}}>\n                    <div className=\"modal_add_imgs\">\n                        <div className=\"edit_entry_add_imgs\">\n                            <h3 style={{textAlign:\"center\", padding:\"10px\"}}>Añadir imagenes al registro</h3>\n                            <Dropzone\n                            onDrop={acceptedFiles => this.onFilesUpload(acceptedFiles)}>\n                            {({getRootProps, getInputProps, isDragActive}) => (\n                                <section>\n                                <div style={{fontSize: \"small\", fontStyle:\"italic\", textAlign:\"center\"}}> \n                                    Los nombres de las imagenes tienen que ser únicos \n                                </div>\n                                <div {...getRootProps()}    \n                                    className=\"dropzone addDropzone\">\n                                    <input {...getInputProps()} />\n                                    {\n                                        this.state.modal_images.length === 0\n                                        ? isDragActive \n                                            ? <div className=\"drop_label row\">\n                                                    <p style={{width:\"100%\"}}>Suelta las imágenes aqui... </p>\n                                                </div> \n                                            : <div className=\"drop_label row\">\n                                                    <p style={{width:\"100%\"}}> Arrastra y suelta las imágenes, o had click aquí para seleccionar imagenes</p>\n                                                </div> \n                                        : null\n                                    }\n\n                                    {   this.state.display_add_modal === ''\n                                        ?\n                                            this.state.modal_images.map(\n                                                image => (\n                                                    <div className=\"addentry_row row\"\n                                                        key={image.name}>\n                                                        <div className=\"col-10\">{image.name}</div>\n                                                        <div className=\"col-2\" style={{cursor:\"pointer\"}} onClick={(e) => this.onImgRemove(e, image.name)}> Borrar </div>\n                                                    </div>\n                                                    )\n                                            )\n                                        : null\n                                    }\n                                </div>\n                                </section>\n                            )}\n                            </Dropzone>\n                            <div className=\"modal_add_btns\"\n                                >\n                                <button\n                                    className=\"btn btn-primary\"\n                                    onClick={this.addImages}\n                                    > \n                                    Añadir imagenes \n                                </button>\n                                <button\n                                    className=\"btn btn-secondary\"\n                                    onClick={this.closeAddImgs}\n                                    >\n                                    Cancelar \n                                </button>\n                                <div className=\"login_error\"> {this.state.edit_error_message} </div>\n                            </div>                            \n                        </div>\n                    </div>\n                </div>\n                <div className=\"modal_edit_entry_detail\">\n                    <button type=\"button\" className=\"close\" id=\"btn_close_modal\" aria-label=\"Close\" onClick={this.closeModal}>\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    <div style={{display: this.state.display_delete_modal}} >\n                        <DeleteModal\n                                title={this.getTitle()} \n                                onClick={this.confirmRemoveEntry}\n                                selectedId = {this.state.selected_entry_id}\n                                onCancelClick= {this.closeModal}\n                                />\n                    </div>\n                    <div style={{display: this.state.display_edit_modal}}>\n                        <div className=\"form_edit_entry height_100\">\n                            <h3>Editar registro</h3>\n                            <form>\n                                <label className=\"username_label\">Título</label>\n                                <input value={this.state.modal_title}\n                                        onChange={this.onChangeModalTitle}\n                                        type=\"text\"\n                                        required\n                                        />\n                                <br/>\n                                <label className=\"useremail_label\">Autor</label>\n                                <br/>\n                                <input value={this.state.modal_author}\n                                        onChange={this.onChangeModalAuthor}\n                                        type=\"text\"\n                                        required\n                                        />\n                                <br/>\n\n                                <label className=\"userpass_label\">Año</label>\n                                <br/>\n                                <input\n                                    value={this.state.modal_year}\n                                    onChange={this.onChangeModalYear}\n                                    type=\"text\"\n                                    />\n                                <br/>\n\n                                <button \n                                        style={{margin:\"5px 0px\"}}\n                                        onClick={(e) => this.saveEditEntry(e)} \n                                        type=\"button\" \n                                        className=\"btn btn-primary\" \n                                        data-dismiss=\"modal\">\n                                        Guardar\n                                        </button>\n\n                                <div style={{color:\"red\", textAlign:\"center\"}}>\n                                    {this.state.edit_error_message}\n                                </div>\n                            </form>\n                            <div className=\"edit_entry_img_btns\">\n                                <button \n                                    style={{marginRight:\"10px\"}}\n                                    onClick={this.addImgToEntry} \n                                    type=\"button\" \n                                    className=\"btn btn-primary\" \n                                    data-dismiss=\"modal\">\n                                    Añadir imagenes\n                                    </button>\n\n                                <button \n                                    onClick={(e) => this.editEntryImages(e)} \n                                    type=\"button\" \n                                    className=\"btn btn-primary\" \n                                    data-dismiss=\"modal\">\n                                    Editar imagenes\n                                    </button>\n                                </div>\n\n                            <button onClick={this.closeModal} \n                                    type=\"button\" \n                                    className=\"btn btn-secondary\" \n                                    data-dismiss=\"modal\">\n                                    Cerrar\n                                    </button>\n\n                        </div>\n                    </div>\n                    <div style={{display: this.state.display_edit_imgs_modal}}>\n                        <LightboxReview \n                            closeModal={this.closeLightbox}\n                            entry_id={this.state.selected_entry_id}\n                            imgs={this.state.modal_images}\n                            />\n                    </div>\n                </div>\n                <div className=\"entry_flex_wrapper modal_entry_detail\"\n                    style={{display: this.state.display_detailed_view}}\n                    >\n                    <button type=\"button\" \n                            className=\"close\" \n                            id=\"btn_close_modal\" \n                            aria-label=\"Close\" \n                            onClick={this.closeModal}\n                            style={{position: \"absolute\", right: \"0\", top: \"0\"}}\n                            >\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    <div className=\"m_data row\"><h3>Vista de registro detallada</h3></div>\n                    <div className=\"m_data row m_title\">Título: {this.state.modal_title}</div>\n                    <div className=\"m_data row m_author\">Autor: {this.state.modal_author}</div>\n                    <div className=\"m_data row m_year\">Año: {this.state.modal_year}</div>\n                    <div className=\"m_data row m_imagenes_title\">Imagenes</div>\n                    <div className=\"m_data row m_images\">   \n                        <br></br>\n\n                        <div className=\"m_imagenes_imgs\">\n                            {\n                                this.state.modal_images.map(img => \n                                    <div key={img.id} className=\"modalImageDetail\">\n                                        <img \n                                            alt=\"\" \n                                            className={this.state.data.image_ids \n                                                && this.state.data.image_ids.includes(img.id) \n                                                ? \"eid_image result_found\"\n                                                : \"eid_image \"}\n                                            id={img.id} \n                                            src={this.state.base_url + img.image}\n                                            onClick={() => this.showLightBox(this.state.modal_images.indexOf(img))}\n                                            />\n                                    </div>    \n                                )\n                            }\n                        </div>\n                    </div>\n                </div>\n                <div className=\"modal_img_detail\"\n                    style={{display: this.state.img_detail_display}}\n                    > \n                    {\n                        this.state.isLightBoxOpen && (\n                            <Lightbox\n                                mainSrc={this.state.base_url + this.state.modal_images[photoIndex].image}\n                                nextSrc={this.state.base_url + this.state.modal_images[(img_leng > 1) ? (photoIndex + 1) % img_leng : 0].image}\n                                prevSrc={this.state.base_url + this.state.modal_images[(img_leng > 1) ? (photoIndex + img_leng - 1) % img_leng : 0].image}\n                                onCloseRequest={() => this.setState({ isLightBoxOpen: false })}\n                                onMovePrevRequest={() =>\n                                this.setState({\n                                    photoIndex: (photoIndex + img_leng - 1) % img_leng\n                                })\n                                }\n                                onMoveNextRequest={() =>\n                                this.setState({\n                                    photoIndex: (photoIndex + 1) % img_leng,\n                                })\n                                }\n                                clickOutsideToClose={true}\n                                wrapperClassName={this.state.data.image_ids\n                                    && this.state.data.image_ids.includes(this.state.modal_images[photoIndex].id) \n                                    ? \"result_found_lightbox\"\n                                    : null}\n                            />\n                        )\n                    }\n\n\n                </div>\n            </div>\n\n\n            <div className=\"search_body\">\n                <div className=\"search_filters col-xs-4 col-md-2\">\n                    <div className=\"sf_category xs-12\">\n                        Filtros\n                    </div>\n                    <div className=\"search_filter sf_border_bottom xs-12\">\n                        <div className=\"sf_name\">\n                            Autor\n                        </div>\n                        <div className=\"sf_filter\">\n                            <AuthorList\n                                onChange={this.onAuthorSelect}\n                                authors={this.state.authors}\n                                value={this.state.filter_author}\n                            />\n                        </div>\n                    </div>\n                    <div className=\"search_filter xs-12\">\n                        <div className=\"sf_name\">\n                            Filtro por año\n                        </div>\n                        <div className=\"sf_filter\">\n                            <Range \n                                min={this.state.min_year} \n                                max={this.state.max_year} \n                                defaultValue={[this.state.filter_from_year, this.state.filter_to_year]} \n                                onChange={this.handle}\n                            />\n                        </div>\n                        <div className=\"sf_value\">\n                            {this.state.filter_from_year} - {this.state.filter_to_year}\n                        </div>\n                    </div>\n                    <div className=\"sf_category xs-12\">\n                        Ordenar por...\n                    </div>\n                    <div className=\"search_filter sf_border_bottom xs-12\">\n                        <div className=\"sf_name\">\n                            Autor\n                        </div>\n                        <div className=\"sf_filter\">\n                            <OrderBySelector\n                                onChange={this.onAuthorOrder}\n                                name=\"order_by_author\"\n                                value={this.state.order_by_author}\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"search_filter sf_border_bottom xs-12\">\n                        <div className=\"sf_name\">\n                            Fecha creación registro\n                        </div>\n                        <div className=\"sf_filter\">\n                            <OrderBySelector\n                                onChange={this.onCreatedOrder}\n                                name=\"order_by_reated\"\n                                value={this.state.order_by_created}\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"search_filter sf_border_bottom xs-12\">\n                        <div className=\"sf_name\">\n                            Título\n                        </div>\n                        <div className=\"sf_filter\">\n                            <OrderBySelector\n                                onChange={this.onTitleOrder}\n                                name=\"order_by_title\"\n                                value={this.state.order_by_title}\n                            />\n                        </div>\n                    </div>\n                    <div className=\"search_filter xs-12\">                        \n                        <div className=\"sf_name\">\n                            Año\n                        </div>\n                        <div className=\"sf_filter\">\n                            <OrderBySelector\n                                onChange={this.onYearOrder}\n                                name=\"order_by_year\"\n                                value={this.state.order_by_year}\n                            />\n                        </div>\n                    </div>\n                    <div className=\"search_filter xs-12\">\n                        <button onClick={this.fetchData} className=\"sf_name filter_btn\">\n                            Refinar la busqueda!\n                        </button>\n                    </div>\n                </div>\n                <div className=\"search_results_wrapper col-xs-8 col-md-10\">\n                    <div className=\"search_results\">\n                        <div className=\"sr_searchbar\">\n                            <input \n                                onChange={this.handleInputChange} \n                                type=\"text\" \n                                id=\"searchBarSearch\" \n                                className=\"form-control col-xs-9 display_inline_block\" \n                                value={this.state.query_text} \n                                required=\"\" \n                                autoFocus={true}\n                                onKeyPress = { (e) => {\n                                        if(e.key === 'Enter') {\n                                            this.fetchData();\n                                        }\n                                    }\n                                }\n                                />\n                            <span className=\"input-group-btn col-xs-2\">\n                                <button onClick={this.fetchData} className=\"btn btn-search\" type=\"button\">\n                                    <i className=\"fa fa-search fa-fw display_inline_block\"></i>\n                                </button>\n                            </span>\n                        </div>\n                        <EntriesList entries={this.state.data.entries} \n                                    resultOnImgs={this.state.data.image_ids}\n                                    base_url={this.state.base_url} \n                                    onClick={this.onEntryClick} \n                                    onRemoveClick={this.removeEntry}\n                                    onEditClick={this.editEntry}\n                                    editDelete={true}\n                                    />\n                        { this.state.total_elements>0 ? \n                            <div className=\"pagination_container\">\n                                <div className=\"total_elements\"> \n                                    {(page*this.state.page_size)+1} - {Math.min(this.state.total_elements, ( (1+page) * this.state.page_size ) )} de {this.state.total_elements}\n                                </div>\n                                <Button name=\"previous_page_btn\"\n                                        disabled={page+1 === 1} \n                                        onClick={this.onPreviousPage}/>\n                                <Button name=\"next_page_btn\" \n                                        disabled={page+1 === Math.ceil(this.state.total_elements/this.state.page_size)} \n                                        onClick={this.onNextPage}/>\n                            </div>\n                            :\n                            <div></div>\n                        }\n                    </div>\n                </div>\n            </div>\n\n        </div>\n            \n        )\n    }\n\n}\n\nexport default EntryTable;"]},"metadata":{},"sourceType":"module"}