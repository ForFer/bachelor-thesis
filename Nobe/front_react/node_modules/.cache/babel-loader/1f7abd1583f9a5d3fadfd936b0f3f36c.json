{"ast":null,"code":"import _classCallCheck from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/fernando/tfg/portal/reactfront/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/fernando/tfg/portal/reactfront/src/components/entry/lightboxEdit.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nvar base_url = 'http://127.0.0.1:8000';\n\nfunction leftKeyListener(event, callback) {\n  if (event.keyCode === 39) {\n    callback();\n  }\n}\n\nfunction rightKeyListener(event, callback) {\n  if (event.keyCode === 37) {\n    callback();\n  }\n}\n\nvar LightboxReview =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LightboxReview, _Component);\n\n  function LightboxReview(props) {\n    var _this;\n\n    _classCallCheck(this, LightboxReview);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LightboxReview).call(this, props));\n\n    _this.onChangeIndex = function (e) {\n      _this.setState({\n        img_index: e.target.value\n      });\n    };\n\n    _this.state = {\n      entry_id: '',\n      images: [],\n      deleted_imgs: [],\n      img_index: 0\n    };\n    _this.childCloseModal = _this.childCloseModal.bind(_assertThisInitialized(_this));\n    _this.nextImage = _this.nextImage.bind(_assertThisInitialized(_this));\n    _this.previousImage = _this.previousImage.bind(_assertThisInitialized(_this));\n    _this.onChangeText = _this.onChangeText.bind(_assertThisInitialized(_this));\n    _this.onChangeIndex = _this.onChangeIndex.bind(_assertThisInitialized(_this));\n    _this.onDeleteImage = _this.onDeleteImage.bind(_assertThisInitialized(_this));\n    _this.uploadAndClose = _this.uploadAndClose.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(LightboxReview, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      document.addEventListener(\"left\", function (e) {\n        return leftKeyListener(e, _this2.previousImage);\n      }, false);\n      document.addEventListener(\"right\", function (e) {\n        return rightKeyListener(e, _this2.previousImage);\n      }, false);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"left\", leftKeyListener, false);\n      document.removeEventListener(\"right\", rightKeyListener, false);\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.setState({\n        images: this.props.imgs,\n        entry_id: this.props.entry_id\n      });\n    }\n  }, {\n    key: \"childCloseModal\",\n    value: function childCloseModal() {\n      this.setState({\n        entry_id: '',\n        images: [],\n        deleted_imgs: [],\n        img_index: 0\n      });\n      this.props.closeModal();\n    }\n  }, {\n    key: \"previousImage\",\n    value: function previousImage() {\n      var previousIndex = this.state.img_index === 0 ? 0 : this.state.img_index - 1;\n      this.setState({\n        img_index: previousIndex\n      });\n    }\n  }, {\n    key: \"nextImage\",\n    value: function nextImage() {\n      var nextIndex = this.state.img_index + 1 === this.props.imgs.length ? this.state.img_index : this.state.img_index + 1;\n      this.setState({\n        img_index: nextIndex\n      });\n    }\n  }, {\n    key: \"onChangeText\",\n    value: function onChangeText(e) {\n      var imgs = this.props.imgs;\n      imgs[this.state.img_index].text = e.target.value;\n      this.setState({\n        images: imgs\n      });\n    }\n  }, {\n    key: \"uploadAndClose\",\n    value: function uploadAndClose() {\n      var _this3 = this;\n\n      var data = {\n        images: [],\n        to_delete: []\n      };\n      this.props.imgs.map(function (image) {\n        return data.images.push({\n          \"id\": image.id,\n          \"text\": image.text\n        });\n      });\n      this.state.deleted_imgs.map(function (image_id) {\n        return data.to_delete.push({\n          \"id\": image_id\n        });\n      });\n      axios.put(base_url + '/images/', data, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          'Authorization': \"Token \".concat(localStorage.getItem(\"token\"))\n        }\n      }).then(function (res) {\n        window.alert(\"Cambios guardados correctamente\");\n\n        _this3.childCloseModal();\n      });\n    }\n  }, {\n    key: \"onDeleteImage\",\n    value: function onDeleteImage(e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (this.props.imgs.length > 1) {\n        var confirm = window.confirm(\"¿Confirmar borrar la imagen?\");\n\n        if (confirm) {\n          var imgs = this.props.imgs;\n          var deleted_imgs = this.state.deleted_imgs;\n          var deleted_img = imgs.splice(this.state.img_index, 1);\n          deleted_imgs.push(deleted_img[0].id);\n          var newIndex = this.state.img_index === imgs.length ? imgs.length - 1 : this.state.img_index;\n          this.setState({\n            images: imgs,\n            deleted_imgs: deleted_imgs,\n            img_index: newIndex\n          });\n        }\n      } else {\n        window.alert(\"No se pueden borrar todas las imagenes\");\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var style1 = {\n        position: 'fixed',\n        inset: '0px',\n        backgroundColor: 'transparent',\n        zIndex: 1000\n      };\n      var style2 = {\n        position: 'absolute',\n        inset: '0px',\n        border: 'medium none',\n        background: 'transparent none repeat scroll 0% 0%',\n        overflow: 'hidden',\n        borderRadius: '0px',\n        outline: 'currentcolor none medium',\n        padding: '0px'\n      };\n      var style3 = {\n        transition: 'opacity 300ms ease 0s',\n        animationDuration: '300ms',\n        animationDirection: 'reverse'\n      };\n\n      if (!this.state.images) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"reviewWrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"ReactModal__Overlay ReactModal__Overlay--after-open\",\n        style: style1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: style2,\n        className: \"ReactModal__Content ReactModal__Content--after-open\",\n        tabIndex: \"-1\",\n        role: \"dialog\",\n        \"aria-label\": \"Lightbox\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, this.props.imgs.length > 0 ? React.createElement(\"div\", {\n        className: \"ril-outer ril__outer ril__outerAnimating  \",\n        style: style3,\n        tabIndex: \"-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"ril-inner ril__inner\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"review_modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"row review_selector\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"select\", {\n        onChange: this.onChangeIndex,\n        value: this.state.img_index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, this.props.imgs.map(function (x, i) {\n        return React.createElement(\"option\", {\n          value: i,\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }, \"Imagen \".concat(i + 1, \" de \").concat(_this4.props.imgs.length));\n      }))), React.createElement(\"div\", {\n        className: \"row review_content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-6 review_image_image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: base_url + this.props.imgs[this.state.img_index].image,\n        alt: \"Imagen a revisar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"col-6 review_image_form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        style: {\n          textAlign: \"left\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, \"Texto de la imagen\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }), React.createElement(\"textarea\", {\n        className: \"edditImage_text\",\n        value: this.props.imgs[this.state.img_index].text,\n        onChange: this.onChangeText,\n        type: \"text\",\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        className: \"btn btn-danger\",\n        style: {\n          margin: \"5px 0px\"\n        },\n        onClick: function onClick(e) {\n          return _this4.onDeleteImage(e);\n        },\n        type: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, \"Borrar imagen\")))), React.createElement(\"div\", {\n        className: \"row review_generalActions\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"warn\",\n        style: {\n          width: \"100%\",\n          textAlign: \"center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, \"Ning\\xFAn cambio se guardar\\xE1 (incluyendo las im\\xE1genes borradas) hasta que se pulse el bot\\xF3n Guardar los cambios y salir\"), this.props.allowAddImage ? React.createElement(\"button\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }, \"A\\xF1adir imagen\") : null, React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        \"aria-label\": \"Salir sin guardar cambios\",\n        onClick: this.childCloseModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      }, \"Salir sin guardar cambios\"), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary\",\n        \"aria-label\": \"Guardar cambios y salir\",\n        onClick: this.uploadAndClose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, \"Guardar los cambios y salir\")))), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"navigation_btn ril-prev-button ril__navButtons ril__navButtonPrev\",\n        \"aria-label\": \"Previous image\",\n        onClick: this.previousImage,\n        disabled: this.state.img_index === 0,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"navigation_btn ril-next-button ril__navButtons ril__navButtonNext\",\n        \"aria-label\": \"Next image\",\n        onClick: this.nextImage,\n        disabled: this.state.img_index === this.props.imgs.length - 1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290\n        },\n        __self: this\n      })) : null)));\n    }\n  }]);\n\n  return LightboxReview;\n}(Component);\n\nexport default LightboxReview;","map":{"version":3,"sources":["/home/fernando/tfg/portal/reactfront/src/components/entry/lightboxEdit.js"],"names":["React","Component","axios","base_url","leftKeyListener","event","callback","keyCode","rightKeyListener","LightboxReview","props","onChangeIndex","e","setState","img_index","target","value","state","entry_id","images","deleted_imgs","childCloseModal","bind","nextImage","previousImage","onChangeText","onDeleteImage","uploadAndClose","document","addEventListener","removeEventListener","imgs","closeModal","previousIndex","nextIndex","length","text","data","to_delete","map","image","push","id","image_id","put","headers","localStorage","getItem","then","res","window","alert","preventDefault","stopPropagation","confirm","deleted_img","splice","newIndex","style1","position","inset","backgroundColor","zIndex","style2","border","background","overflow","borderRadius","outline","padding","style3","transition","animationDuration","animationDirection","x","i","textAlign","margin","width","allowAddImage"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\n\nimport axios from 'axios';\n\nconst base_url = 'http://127.0.0.1:8000'\n\n\n\nfunction leftKeyListener(event, callback){\n    if(event.keyCode === 39) {\n        callback();\n    }\n}\n\nfunction rightKeyListener(event, callback){\n    if(event.keyCode === 37) {\n        callback();\n    }\n}\n\n\nclass LightboxReview extends Component {\n    constructor(props){\n        super(props) \n\n        this.state = {\n            entry_id: '',\n            images: [],\n            deleted_imgs: [],\n            img_index: 0,\n        }\n                \n        this.childCloseModal = this.childCloseModal.bind(this);\n \n        this.nextImage = this.nextImage.bind(this);\n        this.previousImage = this.previousImage.bind(this);\n\n        this.onChangeText = this.onChangeText.bind(this);\n        this.onChangeIndex = this.onChangeIndex.bind(this);\n        this.onDeleteImage = this.onDeleteImage.bind(this);\n\n        this.uploadAndClose = this.uploadAndClose.bind(this);\n    }\n\n    componentDidMount(){\n        document.addEventListener(\"left\", \n                                  (e) => leftKeyListener(e, this.previousImage), \n                                  false);\n        document.addEventListener(\"right\", \n                                  (e) => rightKeyListener(e, this.previousImage), \n                                  false);\n    }\n    componentWillUnmount(){\n        document.removeEventListener(\"left\", \n                                leftKeyListener, \n                                false);\n        document.removeEventListener(\"right\", \n                                rightKeyListener, \n                                false);\n    }\n\n    componentWillMount(){\n        this.setState({\n            images: this.props.imgs,\n            entry_id: this.props.entry_id,\n        })\n    }\n\n    childCloseModal(){\n        this.setState({\n            entry_id: '',\n            images: [],\n            deleted_imgs: [],\n            img_index: 0,\n        });\n\n        this.props.closeModal();\n    }\n\n    previousImage() {\n        const previousIndex = this.state.img_index === 0\n                    ? 0\n                    : this.state.img_index - 1;\n\n        this.setState({\n            img_index: previousIndex,\n        })\n    }\n\n    nextImage() {\n        const nextIndex = this.state.img_index+1 === this.props.imgs.length\n                    ? this.state.img_index \n                    : this.state.img_index + 1;\n\n        this.setState({\n            img_index: nextIndex,\n        })\n    }\n\n    onChangeText(e) {\n        var imgs = this.props.imgs;\n\n        imgs[this.state.img_index].text = e.target.value;\n\n        this.setState({\n            images: imgs,\n        })\n    }\n\n    onChangeIndex = (e) => {\n        this.setState({\n            img_index: e.target.value,\n        })\n    }\n\n    uploadAndClose() {\n        var data = {\n            images: [],\n            to_delete: [],\n        };\n        \n        this.props.imgs.map(\n            image => data.images.push({\"id\":image.id, \"text\":image.text})\n        )\n\n        this.state.deleted_imgs.map(\n            image_id => data.to_delete.push({\"id\":image_id})\n        )\n\n        axios.put(base_url + '/images/',\n            data,\n            {\n                headers: {\n                    \"Content-Type\":\"multipart/form-data\",\n                    'Authorization': `Token ${localStorage.getItem(\"token\")}`,\n                }\n            }\n        )\n        .then(\n            res => {\n                window.alert(\"Cambios guardados correctamente\");\n\n                this.childCloseModal();\n            }\n        )\n    }\n\n    onDeleteImage(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if(this.props.imgs.length > 1){\n            var confirm = window.confirm(\"¿Confirmar borrar la imagen?\")\n\n            if(confirm){\n                var imgs = this.props.imgs;\n                var deleted_imgs = this.state.deleted_imgs;\n\n                var deleted_img = imgs.splice(this.state.img_index, 1)\n                deleted_imgs.push(deleted_img[0].id)\n\n                var newIndex = (this.state.img_index === imgs.length)\n                    ? imgs.length-1\n                    : this.state.img_index\n\n                this.setState({\n                    images: imgs,\n                    deleted_imgs: deleted_imgs,\n                    img_index: newIndex,\n                })\n            }\n        } else {\n            window.alert(\"No se pueden borrar todas las imagenes\")\n        }        \n    }\n\n\n    render() {\n        const style1 = {position: 'fixed', inset: '0px', backgroundColor: 'transparent', zIndex: 1000}\n        const style2 = {position: 'absolute', inset: '0px', border: 'medium none', background: 'transparent none repeat scroll 0% 0%', overflow: 'hidden', borderRadius: '0px', outline: 'currentcolor none medium', padding: '0px'}\n        const style3 = {transition: 'opacity 300ms ease 0s', animationDuration: '300ms', animationDirection: 'reverse'}\n        \n        if(!this.state.images){\n            return <div></div>\n        }\n\n        return(\n            <div className=\"reviewWrapper\">\n\n                <div className=\"ReactModal__Overlay ReactModal__Overlay--after-open\" \n                    style={style1}>\n\n                    <div style={style2} \n                            className=\"ReactModal__Content ReactModal__Content--after-open\" \n                            tabIndex=\"-1\" \n                            role=\"dialog\" \n                            aria-label=\"Lightbox\">\n\n                    {\n                        this.props.imgs.length > 0\n                        ? <div className=\"ril-outer ril__outer ril__outerAnimating  \" \n                            style={style3} \n                            tabIndex=\"-1\">\n\n                            <div className=\"ril-inner ril__inner\">\n                                <div className=\"review_modal\"> \n                                    <div className=\"row review_selector\">\n                                    {/* pagination */}\n                                        <select\n                                            onChange={this.onChangeIndex}\n                                            value={this.state.img_index}\n                                            >\n                                            {this.props.imgs.map((x, i) => (\n                                                <option value={i}\n                                                        key={i}\n                                                        >\n                                                    {`Imagen ${i+1} de ${this.props.imgs.length}`}\n                                                </option> \n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div className=\"row review_content\">\n                                        {/* content */}\n                                        <div className=\"col-6 review_image_image\">\n                                            <img src={base_url + this.props.imgs[this.state.img_index].image}\n                                                alt=\"Imagen a revisar\" />\n                                        </div>\n                                        <div className=\"col-6 review_image_form\">\n                                            <form>\n                                                <label style={{textAlign: \"left\"}}>Texto de la imagen</label>\n                                                <br/>\n                                                <textarea  className=\"edditImage_text\"\n                                                        value={this.props.imgs[this.state.img_index].text}\n                                                        onChange={this.onChangeText}\n                                                        type=\"text\"\n                                                        required\n                                                        />\n\n                                                <button className=\"btn btn-danger\"\n                                                    style={{margin:\"5px 0px\"}}\n                                                    onClick={(e) => this.onDeleteImage(e)}\n                                                    type=\"button\"\n                                                    >\n                                                    Borrar imagen\n                                                    </button>\n                                            </form>\n                                        </div>\n                                    </div>\n                                    <div className=\"row review_generalActions\">\n                                        {/* general buttons */}\n                                        <div className=\"warn\"\n                                                style={{width:\"100%\", textAlign:\"center\"}}\n                                            >\n                                                    Ningún cambio se guardará (incluyendo las imágenes borradas) \n                                                    hasta que se pulse el botón Guardar los cambios y salir\n                                        </div>\n                                        { this.props.allowAddImage\n                                            ? <button>Añadir imagen</button>\n                                            : null\n                                        }\n                                        <button\n                                            type=\"button\" \n                                            className=\"btn btn-secondary\" \n                                            aria-label=\"Salir sin guardar cambios\"\n                                            onClick={this.childCloseModal}\n                                            >\n                                            Salir sin guardar cambios\n                                            </button>\n                                        <button\n                                            type=\"button\" \n                                            className=\"btn btn-primary\" \n                                            aria-label=\"Guardar cambios y salir\"\n                                            onClick={this.uploadAndClose}\n                                            >\n                                            Guardar los cambios y salir\n                                            </button>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <button type=\"button\" \n                                    className=\"navigation_btn ril-prev-button ril__navButtons ril__navButtonPrev\" \n                                    aria-label=\"Previous image\"\n                                    onClick={this.previousImage}\n                                    disabled={\n                                        this.state.img_index === 0\n                                    }\n                                    >\n                                    </button>\n                            <button type=\"button\" \n                                    className=\"navigation_btn ril-next-button ril__navButtons ril__navButtonNext\" \n                                    aria-label=\"Next image\"\n                                    onClick={this.nextImage}\n                                    disabled={\n                                        this.state.img_index === this.props.imgs.length-1\n                                    }\n                                    >\n                                    </button>\n                    \n                            </div>\n\n                        : null\n                    }\n                        \n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default LightboxReview;"]},"metadata":{},"sourceType":"module"}